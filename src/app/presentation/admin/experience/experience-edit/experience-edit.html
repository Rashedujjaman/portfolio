<div class="experience-edit-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <button mat-icon-button class="back-button" (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
      </button>

      <h1>{{ isEditMode ? 'Edit Experience' : 'Create New Experience' }}</h1>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="goBack()" [disabled]="isSaving">
          Cancel
        </button>
        <button 
          class="btn btn-primary" 
          (click)="onSubmit()" 
          [disabled]="isSaving || experienceForm.invalid">
          <span *ngIf="isSaving">Saving...</span>
          <span *ngIf="!isSaving">{{ isEditMode ? 'Update Experience' : 'Create Experience' }}</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading experience...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading" class="main-content">
    <form [formGroup]="experienceForm" class="experience-form">

      
      <!-- Basic Information Section -->
      <div class="form-section">
        <h2>Basic Information</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="company">Company *</label>
            <input 
              type="text" 
              id="company" 
              formControlName="company"
              class="form-control"
              placeholder="Enter company name">
            <div class="error" *ngIf="experienceForm.get('company')?.invalid && experienceForm.get('company')?.touched">
              Company is required
            </div>
          </div>

          <div class="form-group">
            <label for="position">Position *</label>
            <input 
              type="text" 
              id="position" 
              formControlName="position"
              class="form-control"
              placeholder="Enter position title">
            <div class="error" *ngIf="experienceForm.get('position')?.invalid && experienceForm.get('position')?.touched">
              Position is required
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="location">Location</label>
            <input 
              type="text" 
              id="location" 
              formControlName="location"
              class="form-control"
              placeholder="City, Country">
          </div>

          <div class="form-group">
            <label for="companyWebsite">Company Website</label>
            <input 
              type="url" 
              id="companyWebsite" 
              formControlName="companyWebsite"
              class="form-control"
              placeholder="https://company.com">
          </div>
        </div>
      </div>

      <!-- Employment Period Section -->
      <div class="form-section">
        <h2>Employment Period</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="startDate">Start Date *</label>
            <input 
              type="date" 
              id="startDate" 
              formControlName="startDate"
              class="form-control">
            <div class="error" *ngIf="experienceForm.get('startDate')?.invalid && experienceForm.get('startDate')?.touched">
              Start date is required
            </div>
          </div>

          <div class="form-group">
            <label for="endDate">End Date</label>
            <input 
              type="date" 
              id="endDate" 
              formControlName="endDate"
              class="form-control"
              [disabled]="experienceForm.get('current')?.value">
            <div class="error" *ngIf="experienceForm.get('endDate')?.invalid && experienceForm.get('endDate')?.touched">
              End date is required if not current position
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="current" (change)="onCurrentChange()"> 
              <span class="checkmark"></span>
              This is my current position
            </label>
          </div>
        </div>
      </div>

      <!-- Description Section -->
      <div class="form-section">
        <h2>Job Description</h2>
        
        <div class="form-row">
          <div class="form-group full-width">
            <label for="description">Description *</label>
            <textarea 
              id="description" 
              formControlName="description"
              class="form-control"
              rows="6"
              placeholder="Describe your role, responsibilities, and key contributions..."></textarea>
            <div class="error" *ngIf="experienceForm.get('description')?.invalid && experienceForm.get('description')?.touched">
              Description is required
            </div>
          </div>
        </div>
      </div>

      <!-- Achievements Section -->
      <div class="form-section">
        <h2>Key Achievements</h2>
        
        <div formArrayName="achievements" class="dynamic-section">
          <div class="dynamic-item" *ngFor="let achievement of achievements.controls; let i = index">
            <div class="form-group dynamic-input">
              <label>Achievement {{ i + 1 }}</label>
              <div class="input-with-action">
                <textarea 
                  [formControlName]="i"
                  class="form-control"
                  rows="2"
                  placeholder="Describe a key achievement or accomplishment..."></textarea>
                <button 
                  type="button" 
                  class="btn btn-danger btn-sm remove-btn"
                  (click)="removeAchievement(i)"
                  title="Remove achievement">
                  ×
                </button>
              </div>
            </div>
          </div>
          
          <button 
            type="button" 
            class="btn btn-secondary add-btn"
            (click)="addAchievement()">
            + Add Achievement
          </button>
        </div>
      </div>

      <!-- Technologies Section -->
      <div class="form-section">
        <h2>Technologies & Skills</h2>
        
        <div formArrayName="technologies" class="dynamic-section">
          <div class="dynamic-item" *ngFor="let technology of technologies.controls; let i = index">
            <div class="form-group dynamic-input">
              <label>Technology {{ i + 1 }}</label>
              <div class="input-with-action">
                <input 
                  type="text" 
                  [formControlName]="i"
                  class="form-control"
                  placeholder="Technology, framework, or skill...">
                <button 
                  type="button" 
                  class="btn btn-danger btn-sm remove-btn"
                  (click)="removeTechnology(i)"
                  title="Remove technology">
                  ×
                </button>
              </div>
            </div>
          </div>
          
          <button 
            type="button" 
            class="btn btn-secondary add-btn"
            (click)="addTechnology()">
            + Add Technology
          </button>
        </div>
      </div>
    </form>
  </div>

  <!-- Status Messages -->
  <div class="status-message" *ngIf="errors.length > 0">
    <div class="alert alert-error">
      <ul>
        <li *ngFor="let error of errors">{{ error }}</li>
      </ul>
    </div>
  </div>

  <!-- Save Confirmation -->
  <div class="save-indicator" *ngIf="isSaving">
    <div class="save-overlay"></div>
    <div class="save-modal">
      <div class="save-content">
        <div class="save-spinner"></div>
        <h3>Saving Experience...</h3>
        <p>Please don't close this page.</p>
      </div>
    </div>
  </div>
</div>
